<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vuejs</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.min.css">
  <style>
    .poker {
      width: 71px;
      height: 96px;
      background-image: url(http://taichunmin.idv.tw/images/cards_jfitz.png);
      background-clip: border-box;
      float: left;
      margin-right: 10px;
      margin-bottom: 15px;
      border-radius: 2px;
    }

    .poker-ca{background-position: -1px 0px; }   /* 梅花 1 */
    .poker-c2{background-position: -73px 0px; }  /* 梅花 2 */
    .poker-c3{background-position: -145px 0px; } /* 梅花 3 */
    .poker-c4{background-position: -217px 0px; } /* 梅花 4 */
    .poker-c5{background-position: -289px 0px; } /* 梅花 5 */
    .poker-c6{background-position: -361px 0px; } /* 梅花 6 */
    .poker-c7{background-position: -433px 0px; } /* 梅花 7 */
    .poker-c8{background-position: -505px 0px; } /* 梅花 8 */
    .poker-c9{background-position: -577px 0px; } /* 梅花 9 */
    .poker-ct{background-position: -649px 0px; } /* 梅花 10 */
    .poker-cj{background-position: -721px 0px; } /* 梅花 11 */
    .poker-cq{background-position: -793px 0px; } /* 梅花 12 */
    .poker-ck{background-position: -865px 0px; } /* 梅花 13 */
    .poker-sa{background-position: -1px -96px; }   /* 黑桃 1 */
    .poker-s2{background-position: -73px -96px; }  /* 黑桃 2 */
    .poker-s3{background-position: -145px -96px; } /* 黑桃 3 */
    .poker-s4{background-position: -217px -96px; } /* 黑桃 4 */
    .poker-s5{background-position: -289px -96px; } /* 黑桃 5 */
    .poker-s6{background-position: -361px -96px; } /* 黑桃 6 */
    .poker-s7{background-position: -433px -96px; } /* 黑桃 7 */
    .poker-s8{background-position: -505px -96px; } /* 黑桃 8 */
    .poker-s9{background-position: -577px -96px; } /* 黑桃 9 */
    .poker-st{background-position: -649px -96px; } /* 黑桃 10 */
    .poker-sj{background-position: -721px -96px; } /* 黑桃 11 */
    .poker-sq{background-position: -793px -96px; } /* 黑桃 12 */
    .poker-sk{background-position: -865px -96px; } /* 黑桃 13 */
    .poker-ha{background-position: -1px -192px; }   /* 紅心 1 */
    .poker-h2{background-position: -73px -192px; }  /* 紅心 2 */
    .poker-h3{background-position: -145px -192px; } /* 紅心 3 */
    .poker-h4{background-position: -217px -192px; } /* 紅心 4 */
    .poker-h5{background-position: -289px -192px; } /* 紅心 5 */
    .poker-h6{background-position: -361px -192px; } /* 紅心 6 */
    .poker-h7{background-position: -433px -192px; } /* 紅心 7 */
    .poker-h8{background-position: -505px -192px; } /* 紅心 8 */
    .poker-h9{background-position: -577px -192px; } /* 紅心 9 */
    .poker-ht{background-position: -649px -192px; } /* 紅心 10 */
    .poker-hj{background-position: -721px -192px; } /* 紅心 11 */
    .poker-hq{background-position: -793px -192px; } /* 紅心 12 */
    .poker-hk{background-position: -865px -192px; } /* 紅心 13 */
    .poker-da{background-position: -1px -288px; }   /* 方塊 1 */
    .poker-d2{background-position: -73px -288px; }  /* 方塊 2 */
    .poker-d3{background-position: -145px -288px; } /* 方塊 3 */
    .poker-d4{background-position: -217px -288px; } /* 方塊 4 */
    .poker-d5{background-position: -289px -288px; } /* 方塊 5 */
    .poker-d6{background-position: -361px -288px; } /* 方塊 6 */
    .poker-d7{background-position: -433px -288px; } /* 方塊 7 */
    .poker-d8{background-position: -505px -288px; } /* 方塊 8 */
    .poker-d9{background-position: -577px -288px; } /* 方塊 9 */
    .poker-dt{background-position: -649px -288px; } /* 方塊 10 */
    .poker-dj{background-position: -721px -288px; } /* 方塊 11 */
    .poker-dq{background-position: -793px -288px; } /* 方塊 12 */
    .poker-dk{background-position: -865px -288px; } /* 方塊 13 */

    .poker-back{background-image: url(http://taichunmin.idv.tw/images/card_jfitz_back.png);} /* 卡背 */
    .poker-back-heartstone{
      background-image: url(http://taichunmin.idv.tw/images/cardback-rankedladder.png);
      background-size: 100% 100%;
    } /* 卡背 */

    [v-cloak] { display: none }

    .panel-poker {
      padding-right: 5px;
      padding-bottom: 0;
    }

    #btn-control {
      margin-bottom: 20px;
      margin-right: 0;
    }

    #btn-control .col-xs-4 {
      padding-right: 0;
    }
  </style>
</head>
<body>
  <div class="container" id="app" v-cloak>
    <h1>Black Jack <small>{{ 'Score: ' + score }}</small></h1>
    <div class="alert alert-success" role="alert" v-html="msgStr || 'No message.'"></div>
    <div class="row" id="btn-control">
      <div class="col-xs-4"><button class="btn btn-block btn-success" v-on:click="hit">Hit</button></div>
      <div class="col-xs-4"><button class="btn btn-block btn-primary" v-on:click="stand">Stand</button></div>
      <div class="col-xs-4"><button class="btn btn-block btn-danger" v-on:click="deal">Deal</button></div>
    </div>
    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title"><span class="glyphicon glyphicon-user"></span> Player <span class="badge">{{ playerScore }}</span></h3>
      </div>
      <div class="panel-body panel-poker">
        <div v-for="card in player" v-bind:class="'poker poker-' + card"></div>
      </div>
    </div>
    <div class="panel panel-danger">
      <div class="panel-heading">
        <h3 class="panel-title"><span class="glyphicon glyphicon-fire"></span> Dealer <span class="badge">{{ playing ? '?' : dealerScore }}</span></h3>
      </div>
      <div class="panel-body panel-poker">
        <div v-for="(card, i) in dealer" class="poker" v-bind:class="(playing && i==0) ? cardback : ('poker-' + card)"></div>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.10/vue.js"></script>
  <script>
    'use strict';

    let vm = new Vue({
      el: '#app',
      data() {
        return {
          player: [], // player hands
          dealer: [], // dealer hands
          deck: [],
          playing: false,
          suits: ["c", "s", "h", "d"],
          ranks: ["a", "2", "3", "4", "5", "6", "7", "8", "9", "t", "j", "q", "k"],
          cardback: "poker-back-heartstone",
          score: 0,
          msgStr: "",
          msgColor: "info",
        };
      },
      computed: {
        playerScore() {
          return this.calcScore(this.player);
        },
        dealerScore() {
          return this.calcScore(this.dealer);
        },
      },
      mounted() {
        this.deal();
      },
      methods: {
        newDeck() {
          this.deck = [];
          this.suits.forEach(function(suit) {
            this.ranks.forEach(function(rank) {
              this.deck.push(suit+rank);
            }, this);
          }, this);
          this.deck = this.shuffle(this.deck);
          // console.log(this.deck);
        },
        shuffle(v) {
          for(var j, x, i = v.length; i; j = parseInt(Math.random() * i), x = v[--i], v[i] = v[j], v[j] = x);
            return v;
        },
        hit() {
          if(!this.playing) {
            this.msg("Click <strong>Deal</strong> button to restart.");
            return;
          }
          if( this.playerScore <= 21 )
            this.player.push( this.deck.pop() );
          if(this.playerScore > 21)
            this.msg("<strong>Player</strong> have busted", 'warning');
        },
        stand() {
          if(!this.playing) {
            this.msg("Click <strong>Deal</strong> button to restart.");
            return;
          }
          if(this.playerScore <= 21)
            while(this.dealerScore < 17 || this.dealerScore < Math.min(this.playerScore, 21))
              this.dealer.push(this.deck.pop());
          this.playing = false;

          let playerWin = (this.playerScore <= 21 && this.dealerScore < this.playerScore || this.dealerScore > 21);
          if(playerWin) {
            this.score++;
            this.msg('<strong>Player</strong> wins.', 'success');
          } else {
            this.score--;
            this.msg('<strong>Dealer</strong> wins.', 'danger');
          }
        },
        deal() {
          this.newDeck();
          this.player = [];
          this.dealer = [];
          for(let i=0; i<2; i++) {
            this.player.push( this.deck.pop() );
            this.dealer.push( this.deck.pop() );
          }

          if(this.playing) {
            this.score--;
            this.msg("<strong>Player</strong> lose. <strong>Hit</strong> or <strong>stand</strong>?", "success");
          } else {
            this.playing = true;
            this.msg("<strong>Hit</strong> or <strong>stand</strong>?");
          }
        },
        calcScore(hands) {
          let score = 0;
          let ace = false;
          hands.forEach(function(card) {
            score += Math.min(10, this.ranks.indexOf(card[1])+1);
            if(card[1] == 'a')
              ace = true;
          }, this);
          if(ace && score <= 11)
            score += 10;
          if(score < 21 && hands.length > 4)
            score = 21;
          return score;
        },
        msg(str, color = "info") {
          this.msgStr = str;
          this.msgColor = color;
        },
      },
    });
  </script>
</body>
</html>
